<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CPT MARKETS - Imposto / Impuestos</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: 'Roboto', Arial, sans-serif; background:#f7f7f7; padding:40px; }
.container { background:#fff; border-radius:12px; max-width:820px; margin:auto; padding:30px; box-shadow:0 0 10px rgba(0,0,0,0.1); position:relative; }

.header { display:flex; align-items:center; justify-content:space-between; border-bottom:2px solid #0073e6; padding-bottom:10px; margin-bottom:20px; }
.header img { height:50px; }
.company { text-align:right; font-size:14px; color:#555; }

.lang-switch {
  display:flex;
  gap:10px;
  margin-bottom:20px;
  justify-content:flex-end;
}

.lang-btn {
  padding:8px 16px;
  border:1px solid #0073e6;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
  background:#fff;
  transition:0.25s;
  display:flex;
  align-items:center;
  gap:6px;
}

.lang-btn.active {
  background:#0073e6;
  color:#fff;
}

.lang-btn:hover {
  background:#e6f2ff;
}

input, button, select {
  width:100%;
  padding:10px;
  margin:6px 0;
  border:1px solid #ccc;
  border-radius:5px;
  font-size:15px;
}
button { background:#0073e6; color:#fff; cursor:pointer; font-weight:bold; }
button:hover{ background:#005bb5; }

.form-block { display:none; opacity:0; transition: opacity 0.3s ease; }
.form-block.active { display:block; opacity:1; }

.bill { margin-top:25px; border:1px solid #ddd; padding:20px; border-radius:8px; position:relative; }
.bill h3{ text-align:center; color:#0073e6; }
table{ width:100%; border-collapse:collapse; margin-top:10px; }
table, th, td{ border:1px solid #ccc; }
th,td{ padding:8px; text-align:left; font-size:14px; }

.print-btn{ text-align:center; margin-top:20px;}
.footer{ text-align:center; font-size:12px; color:#777; border-top:1px solid #ccc; margin-top:30px; padding-top:10px; }
.footer img{ margin-top:5px; height:80px; }

.stamp-wrap {
  position:absolute;
  bottom:20px;
  right:20px;
  width:160px;
  height:160px;
  pointer-events:none;
}
.stamp-wrap svg { width:160px; height:160px; }

@media print {
  body{ background:#fff; padding:0; }
  .container{ box-shadow:none; border:none; padding:0; }
  form, .lang-switch, .print-btn{ display:none; }
}
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <img src="https://i.ibb.co/C39GNgCx/images.png">
    <div class="company">
      <strong>CPT MARKETS Ltda.</strong><br>
      Suite 305, Blake Building, #16 William Fonseca Street, Belize City, Belize<br>
      <a href="https://www.xjpc.org" target="_blank">www.xjpc.org</a><br>
      https://www.spotify.com
    </div>
  </div>

  <div class="lang-switch">
    <button class="lang-btn active" data-lang="pt">üáßüá∑ Portugu√™s</button>
    <button class="lang-btn" data-lang="es">üá®üá± Espa√±ol</button>
  </div>

  <form id="taxForm">

    <div id="form-pt" class="form-block active">
      <input type="text" name="uid_pt" placeholder="UID do Cliente" required>
      <input type="text" name="name_pt" placeholder="Nome Completo" required>
      <input type="text" name="pix_pt" placeholder="Chave Pix" required>
      <input type="number" name="deposit_pt" placeholder="Dep√≥sito (R$)" step="0.01" min="0" required>
      <input type="number" name="withdraw_pt" placeholder="Retirada (R$)" step="0.01" min="0" required>
      <input type="number" name="taxRate_pt" placeholder="Taxa de Imposto (%)" step="0.01" value="15" required>
      <label><strong>Data de Vencimento</strong></label>
      <input type="date" name="deadline_pt" required>
    </div>

    <div id="form-es" class="form-block">
      <input type="text" name="uid_es" placeholder="UID" required>
      <input type="text" name="name_es" placeholder="Nombre" required>
      <input type="text" name="rut_es" placeholder="RUT" required>
      <input type="text" name="bankName_es" placeholder="Nombre del banco" required>
      <input type="text" name="accountType_es" placeholder="Tipo de cuenta" required>
      <input type="text" name="accountNumber_es" placeholder="N√∫mero de cuenta" required>
      <input type="number" name="deposit_es" placeholder="Dep√≥sito (CLP$)" step="0.01" min="0" required>
      <input type="number" name="withdraw_es" placeholder="Retiro (CLP$)" step="0.01" min="0" required>
      <input type="number" name="taxRate_es" placeholder="Tasa de Impuesto (%)" step="0.01" value="15" required>
      <label><strong>Fecha de Vencimiento</strong></label>
      <input type="date" name="deadline_es" required>
    </div>

    <button type="submit">Gerar / Generar</button>
  </form>

  <div class="bill" id="bill" style="display:none;">
    <h3 id="bill-title"></h3>
    <p><strong id="label-invoice"></strong> <span id="invoiceId"></span></p>
    <p><strong id="label-date"></strong> <span id="date"></span></p>
    <p id="deadlineBox" style="display:none;"><strong>Data de Vencimento:</strong> <span id="deadline"></span></p>
    <p id="deadlineBox_es" style="display:none;"><strong>Fecha de Vencimiento:</strong> <span id="deadline_es"></span></p>
    <table id="billTable"></table>
    <div class="print-btn">
      <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
    </div>
    <div class="stamp-wrap">
      <svg id="stampSvg" viewBox="0 0 160 160">
        <circle cx="80" cy="80" r="66" fill="none" stroke="rgba(200,0,0,0.85)" stroke-width="5"/>
        <defs>
          <path id="arcPath" d="M80,80 m-58,0 a58,58 0 1,1 116,0 a58,58 0 1,1 -116,0"/>
        </defs>
        <text font-size="12" font-family="Arial Black" font-weight="700" fill="rgba(180,0,0,0.85)">
          <textPath href="#arcPath" startOffset="50%" text-anchor="middle">
            CPT MARKETS LTDA ‚Ä¢ BELIZE ‚Ä¢
          </textPath>
        </text>
        <text id="stampWord" x="80" y="80" text-anchor="middle" font-size="16" fill="rgba(200,0,0,0.85)"
          font-weight="900" transform="rotate(25 80 80)">APROVADO</text>
      </svg>
    </div>
  </div>

  <div class="footer">
    CPT MARKETS Ltda. ¬© 2025 ‚Äî Todos os direitos reservados.<br>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://xjpc.org">
  </div>

</div>

<script>
// ËØ≠Ë®ÄÂàáÊç¢
document.querySelectorAll(".lang-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".lang-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const lang = btn.dataset.lang;
    document.querySelectorAll(".form-block").forEach(f=>f.classList.remove("active"));
    document.getElementById("form-"+lang).classList.add("active");
  });
});

// Ê†ºÂºèÂåñÈáëÈ¢ù
function formatBR(n){ return "R$ " + Number(n).toLocaleString("pt-BR",{minimumFractionDigits:2}); }
function formatCL(n){ return "CLP$ " + Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }

// Êèê‰∫§Â§ÑÁêÜ
document.getElementById("taxForm").addEventListener("submit",function(e){
  e.preventDefault();
  const lang=document.querySelector(".lang-btn.active").dataset.lang;
  const table=document.getElementById("billTable");
  table.innerHTML="";

  const invoiceId=Math.floor(100000+Math.random()*900000);
  document.getElementById("invoiceId").innerText=invoiceId;

  const now=new Date();
  const dateStr = now.toLocaleDateString(lang==="pt"?"pt-BR":"es-CL",{year:"numeric",month:"2-digit",day:"2-digit"}) + 
                  " " + now.toLocaleTimeString(lang==="pt"?"pt-BR":"es-CL",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("date").innerText=dateStr;

  if(lang==="pt"){
    const uid=this.uid_pt.value.trim();
    const name=this.name_pt.value.trim();
    const pix=this.pix_pt.value.trim();
    const deposit=parseFloat(this.deposit_pt.value||0);
    const withdraw=parseFloat(this.withdraw_pt.value||0);
    const taxRate=parseFloat(this.taxRate_pt.value||0);
    const deadline=this.deadline_pt.value;
    const profit=withdraw-deposit;
    const tax=profit>0?profit*(taxRate/100):0;
    const total=withdraw+tax;

    document.getElementById("bill-title").innerText="Recibo de C√°lculo de Imposto";
    document.getElementById("label-invoice").innerText="N¬∫ da Fatura:";
    document.getElementById("label-date").innerText="Data de Emiss√£o:";
    document.getElementById("deadlineBox").style.display="block";
    document.getElementById("deadlineBox_es").style.display="none";
    document.getElementById("deadline").innerText=new Date(deadline).toLocaleDateString("pt-BR");

    table.innerHTML+=`
      <tr><th>UID</th><td>${uid}</td></tr>
      <tr><th>Nome</th><td>${name}</td></tr>
      <tr><th>Chave Pix</th><td>${pix}</td></tr>
      <tr><th>Dep√≥sito</th><td>${formatBR(deposit)}</td></tr>
      <tr><th>Retirada</th><td>${formatBR(withdraw)}</td></tr>
      <tr><th>Lucro Calculado</th><td>${formatBR(profit)}</td></tr>
      <tr><th>Imposto Devido</th><td>${formatBR(tax)}</td></tr>
      <tr><th>Total para Saque</th><td>${formatBR(total)}</td></tr>
    `;
    document.getElementById("stampWord").textContent="APROVADO";
  } else {
    const uid=this.uid_es.value.trim();
    const name=this.name_es.value.trim();
    const rut=this.rut_es.value.trim();
    const bank=this.bankName_es.value.trim();
    const type=this.accountType_es.value.trim();
    const number=this.accountNumber_es.value.trim();
    const deposit=parseFloat(this.deposit_es.value||0);
    const withdraw=parseFloat(this.withdraw_es.value||0);
    const taxRate=parseFloat(this.taxRate_es.value||0);
    const deadline=this.deadline_es.value;
    const profit=withdraw-deposit;
    const tax=profit>0?profit*(taxRate/100):0;
    const total=withdraw+tax;

    document.getElementById("bill-title").innerText="Recibo de C√°lculo de Impuestos";
    document.getElementById("label-invoice").innerText="N¬∫ de Factura:";
    document.getElementById("label-date").innerText="Fecha:";
    document.getElementById("deadlineBox").style.display="none";
    document.getElementById("deadlineBox_es").style.display="block";
    document.getElementById("deadline_es").innerText=new Date(deadline).toLocaleDateString("es-CL");

    table.innerHTML+=`
      <tr><th>UID</th><td>${uid}</td></tr>
      <tr><th>Nombre</th><td>${name}</td></tr>
      <tr><th>RUT</th><td>${rut}</td></tr>
      <tr><th>Nombre del banco</th><td>${bank}</td></tr>
      <tr><th>Tipo de cuenta</th><td>${type}</td></tr>
      <tr><th>N√∫mero de cuenta</th><td>${number}</td></tr>
      <tr><th>Dep√≥sito</th><td>${formatCL(deposit)}</td></tr>
      <tr><th>Retiro</th><td>${formatCL(withdraw)}</td></tr>
      <tr><th>Ganancia</th><td>${formatCL(profit)}</td></tr>
      <tr><th>Impuesto a Pagar</th><td>${formatCL(tax)}</td></tr>
      <tr><th>Total de Retiro</th><td>${formatCL(total)}</td></tr>
    `;
    document.getElementById("stampWord").textContent="APROBADO";
  }

  document.getElementById("bill").style.display="block";
});
</script>
</body>
</html>
